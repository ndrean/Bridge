# microvm-apple-silicon.yaml - For Apple Silicon Macs
images:
  - location: "https://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-arm64.img"
    arch: "aarch64"
arch: "aarch64"  # Crucial for Apple Silicon!
cpus: 4
memory: "8GiB"
disk: "50GiB"
mounts:
  - location: "~"
    writable: true
ssh:
  localPort: 60022
  forwardAgent: true
# Use vz for better performance on macOS Ventura+
# Use qemu for wider compatibility
vmType: "qemu"
provision:
  - mode: system
    script: |
      echo "=== Setting up Ubuntu ARM64 for microVMs ==="
      apt-get update
      apt-get install -y qemu-system-aarch64 qemu-utils \
        libvirt-daemon-system libvirt-clients git curl wget \
        build-essential pkg-config libssl-dev
      usermod -a -G kvm,libvirt $USER
      echo "=== ARM64 KVM setup complete ==="
  - mode: user
    script: |
      echo "=== Setting up ARM64 environment ==="
      mkdir -p ~/microvm-lab/{kernels,rootfs,scripts,configs}
      echo "=== Ready for ARM64 microVMs ==="
